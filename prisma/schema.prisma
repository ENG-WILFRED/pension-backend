// Prisma schema for transaction management with M-Pesa integration

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// User model for authentication and account management
model User {
  id        String     @id @default(cuid())
  email     String     @unique
  password  String
  firstName String?
  lastName  String?
  phone     String?
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt

  // Relations
  transactions Transaction[]

  @@map("users")
}

// Transaction model for tracking financial movements and M-Pesa transfers
model Transaction {
  id              String   @id @default(cuid())
  userId          String?
  user            User?    @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // Transaction details
  amount          Float
  type            String   // "credit", "debit", "registration"
  status          String   @default("pending") // "pending", "completed", "failed"
  description     String?
  
  // M-Pesa specific fields
  mpesaCheckoutId String?  @unique
  checkoutRequestId String? @unique
  mpesaRef        String?  @unique
  
  // Registration metadata (for registration type transactions)
  metadata        Json?
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([userId])
  @@map("transactions")
}
